<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Función de Onda</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.26.0/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1e1e2f;
            color: #ffffff;
            text-align: center;
            padding: 20px;
        }
        h1 {
            color: #00d1b2;
        }
        h2 {
            color: #00b4d8;
            margin: 20px 0 10px;
        }
        p {
            font-size: 14px;
            color: #c9c9c9;
            margin-bottom: 20px;
        }
        label, button, select {
            font-size: 16px;
            margin: 10px;
        }
        input, select {
            padding: 8px;
            margin: 10px;
            border: 1px solid #00d1b2;
            border-radius: 5px;
        }
        button {
            background-color: #00d1b2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            padding: 10px 20px;
        }
        button:hover {
            background-color: #007b84;
        }
        canvas, #3dPlot {
            margin: 20px auto;
            border: 2px solid #00d1b2;
            border-radius: 5px;
        }
        #exportContainer {
            margin-top: 20px;
        }
        #solutionBox, #solutionSteps, #solutionResult {
            margin-top: 30px;
            text-align: left;
        }
        #solutionBox h3, #solutionSteps h3, #solutionResult h3 {
            color: #00b4d8;
        }
        #solutionResult p {
            color: #00d1b2;
            font-size: 16px;
        }
        body {
            font-family: 'Arial', sans-serif;
            background-color: #1e1e2f;
            color: #ffffff;
            text-align: center;
            padding: 20px;
        }
        h1 {
            color: #00d1b2;
        }
        h2 {
            color: #00b4d8;
            margin: 20px 0 10px;
        }
        p {
            font-size: 14px;
            color: #c9c9c9;
            margin-bottom: 20px;
        }
        label, button, select {
            font-size: 16px;
            margin: 10px;
        }
        input, select {
            padding: 8px;
            margin: 10px;
            border: 1px solid #00d1b2;
            border-radius: 5px;
        }
        button {
            background-color: #00d1b2;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            padding: 10px 20px;
        }
        button:hover {
            background-color: #007b84;
        }
        canvas, #3dPlot {
            margin: 20px auto;
            border: 2px solid #00d1b2;
            border-radius: 5px;
        }
        #exportContainer {
            margin-top: 20px;
        }
        #solutionBox, #solutionSteps, #solutionResult {
            margin-top: 30px;
            text-align: left;
        }
        #solutionBox h3, #solutionSteps h3, #solutionResult h3 {
            color: #00b4d8;
        }
        #solutionResult p {
            color: #00d1b2;
            font-size: 16px;
        }
        /* Estilos para la ventana flotante */
        #helpOverlay {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 70%;
            background-color: #2e2e3e;
            color: #ffffff;
            border: 2px solid #00d1b2;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            overflow-y: auto;
            padding: 20px;
            z-index: 1000;
        }
        #helpOverlay h2 {
            color: #00b4d8;
        }
        #helpOverlay p, #helpOverlay ul {
            font-size: 14px;
            color: #c9c9c9;
        }
        #helpOverlay button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #ff4444;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            padding: 5px 10px;
        }
        #helpOverlay button:hover {
            background-color: #cc0000;
        }
    </style>
</head>
<body>
    <h1>Simulador de Función de Onda</h1>
    
    <!-- Controles de parámetros -->
    <label for="quantumNumber">Número cuántico (n): </label>
    <input type="number" id="quantumNumber" value="1" min="1" max="10" />
    <label for="boxSize">Tamaño de la caja (L): </label>
    <input type="number" id="boxSize" value="1" min="0.1" step="0.1" />
    <label for="time">Tiempo (t): </label>
    <input type="number" id="time" value="0" min="0" step="0.1" />
    
    <button onclick="updateGraph()">Actualizar</button>
    <button id="toggleAnimationBtn" onclick="toggleAnimation()">Reanudar Animación</button>

    <!-- Exportar datos -->
    <div id="exportContainer">
        <label for="exportFormat">Exportar como: </label>
        <select id="exportFormat">
            <option value="csv">CSV</option>
            <option value="xlsx">Excel</option>
            <option value="pdf">PDF</option>
        </select>
        <button onclick="exportData()">Exportar</button>
    </div>
    

    <!-- Botón de ayuda -->
    <button onclick="openHelp()">Ayuda</button>

    <!-- Ventana flotante de ayuda -->
    <div id="helpOverlay">
        <button onclick="closeHelp()">Cerrar</button>
        <h2>Manual de Usuario</h2>
        <p>Este manual está diseñado para ayudar al usuario a comprender y operar el simulador de función de onda desarrollado como parte del estudio del Segundo Postulado de la Mecánica Cuántica. Este simulador facilita la exploración de funciones de onda cuánticas y densidades de probabilidad.</p>
        <h3>Estructura General
            </h3>
        <ul>
            <p>Este es un simulador de la función de onda de una partícula en una caja cuántica usando HTML, CSS y JavaScript. Se incluyen dos visualizaciones: una gráfica 2D con Chart.js y otra 3D con Plotly.js. Además, hay opciones de exportación de datos en CSV, Excel y PDF.</p>
        </ul>
        <h3>1. Iniciando el simulador</h3>
        <ul>
            <p>Asegúrese de que los scripts de JavaScript se carguen correctamente (no bloquee contenido activo).</p>
            <p>Visualizará un panel con controles, gráficos y opciones de exportación.</p>
        </ul>
        <h3>2. Panel de control</h3>
        <ul>
            <p>Número cuántico (n): Ajuste el valor del número cuántico n (mínimo 1).</p>
            <p>Tamaño de la caja (L): Configure el tamaño del pozo cuántico (L).</p>
            <p>Tiempo (t): Ingrese el tiempo para observar la evolución de la función de onda.</p>
            <p>Botones de actualización y animación: Permiten actualizar las gráficas manualmente o iniciar/pausar la animación.</p>
        </ul>
        <h3>3. Exportación de datos</h3>
        <ul>
            <p>Seleccione el formato deseado del menú desplegable(Csv,Excel,PDF).</p>
            <p>Haga clic en el botón 'Exportar'.</p>
            <p>Guarde el archivo generado.</p>
        </ul>
        <h3>4. Gráficos generados</h3>
        <ul>
            <p>Gráfico 2D: Representa la función de onda (ψ) y la densidad de probabilidad (|ψ|²) la tabla dispone de animacion desde el boton .</p>
            <p>Gráfico 3D: Muestra la evolución temporal de la densidad de probabilidad.</p>
        </ul>
        <h3>5. Consejos de uso</h3>
        <ul>
            <p>Ingrese valores razonables para n y L para evitar resultados poco prácticos.</p>
            <p>Use la animación para visualizar cambios temporales en la densidad de probabilidad.</p>
            <p>Consulte la sección de soluciones paso a paso para verificar cálculos específicos.</p>
        </ul>
    </div>


    <!-- Gráficas -->
    <h2>Gráfica en 2D: Función de onda y densidad de probabilidad</h2>
    <canvas id="waveChart" width="800" height="400"></canvas>
    <div id="solutionResult">
    <h3>Densidad de probabilidad en el punto medio:</h3>
    <p id="numericalResult"></p>
</div>


    <h2>Gráfica en 3D: Evolución temporal de la densidad de probabilidad</h2>
    <div id="3dPlot" style="width: 100%; height: 500px;"></div>

    <!-- Soluciones -->
    <div id="solutionBox">
        <h3>Solución para n = <span id="solutionN">1</span> y L = <span id="solutionL">1.0</span></h3>
        <p id="solutionText"></p>
    </div>
    <div id="solutionSteps">
        <h3>Solución paso a paso:</h3>
        <ol id="stepsList"></ol>
    </div>

  <script>
    // Variables iniciales
    const L_DEFAULT = 1.0;
    const x = Array.from({ length: 100 }, (_, i) => i * L_DEFAULT / 100);
    let t = 0;
    let n = 1;
    let L = L_DEFAULT;
    let animationRunning = false;
    let interval;

    // Función de onda y densidad de probabilidad
    function psi(x, t, n, L) {
        return Math.sqrt(2 / L) * Math.sin((n * Math.PI * x) / L) * Math.cos(t);
    }

    function probDensity(x, t, n, L) {
        return Math.pow(psi(x, t, n, L), 2);
    }

    function generateData(t, n, L) {
        return {
            waveFunction: x.map((xi) => psi(xi, t, n, L)),
            probabilityDensity: x.map((xi) => probDensity(xi, t, n, L)),
        };
    }

    // Inicialización de la gráfica 2D
    const ctx = document.getElementById('waveChart').getContext('2d');
    let { waveFunction, probabilityDensity } = generateData(t, n, L);
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: x,
            datasets: [
                {
                    label: 'Función de onda (ψ)',
                    data: waveFunction,
                    borderColor: 'blue',
                    borderWidth: 2,
                    fill: false,
                },
                {
                    label: 'Densidad de probabilidad (|ψ|²)',
                    data: probabilityDensity,
                    borderColor: 'red',
                    borderWidth: 2,
                    fill: false,
                },
            ],
        },
        options: {
            responsive: true,
            scales: {
                x: { title: { display: true, text: 'Posición (x)' } },
                y: { title: { display: true, text: 'Valor' } },
            },
        },
    });
// Actualizar gráfica 2D usando Plotly
function update2DPlot() {
    const xMid = L / 2;
    const waveFunctionData = x.map((xi) => psi(xi, t, n, L));
    const probabilityDensityData = x.map((xi) => probDensity(xi, t, n, L));
    const resultDensity = probDensity(xMid, t, n, L).toFixed(4);

    Plotly.react('waveChart', [
        {
            x: x,
            y: waveFunctionData,
            name: 'Función de onda (ψ)',
            type: 'scatter',
            line: { color: 'blue' },
        },
        {
            x: x,
            y: probabilityDensityData,
            name: 'Densidad de probabilidad (|ψ|²)',
            type: 'scatter',
            line: { color: 'red' },
        },
        {
            x: [xMid, xMid],
            y: [0, resultDensity],
            name: `Densidad en x = ${xMid}`,
            mode: 'markers',
            type: 'scatter3d',
            line: { dash: 'dot', color: 'white' },
            marker: { size: 5, color: 'yellow' },
            text: [`|ψ|² = ${resultDensity}`],
            textposition: 'top center',
            name: `Punto en x=${xMid}`
        }
        
    ], {
        title: 'Función de Onda y Densidad de Probabilidad 2d ',
        xaxis: { title: 'Posición (x)' },
        yaxis: { title: 'Valor' }
    });
}

// Llamada en actualización y animación
function updateGraph() {
    n = parseFloat(document.getElementById('quantumNumber').value);
    L = parseFloat(document.getElementById('boxSize').value);
    t = parseFloat(document.getElementById('time').value);
    document.getElementById('solutionN').innerText = n;
    document.getElementById('solutionL').innerText = L;
    updateSteps(n, L);
    chart.data.datasets[0].data = generateData(t, n, L).waveFunction;
    chart.data.datasets[1].data = generateData(t, n, L).probabilityDensity;
    chart.update();
    update2DPlot(); // Nueva gráfica 2D con punto señalado
    update3DPlot();
}

function animateWave() {
    if (!animationRunning) return;
    t += 0.05;
    const newData = generateData(t, n, L);
    chart.data.datasets[0].data = newData.waveFunction;
    chart.data.datasets[1].data = newData.probabilityDensity;
    chart.update();
    update2DPlot(); // ACTUALIZACIÓN DE LA GRÁFICA 2D EN ANIMACIÓN
    update3DPlot();
}


    // Actualizar gráficos
    function updateGraph() {
        n = parseFloat(document.getElementById('quantumNumber').value);
        L = parseFloat(document.getElementById('boxSize').value);
        t = parseFloat(document.getElementById('time').value);
        document.getElementById('solutionN').innerText = n;
        document.getElementById('solutionL').innerText = L;
        updateSteps(n, L);
        const newData = generateData(t, n, L);
        chart.data.datasets[0].data = newData.waveFunction;
        chart.data.datasets[1].data = newData.probabilityDensity;
        chart.update();
        update3DPlot();
        const result = probDensity(L / 2, t, n, L).toFixed(4);
        document.getElementById('numericalResult').innerText = `El valor de la densidad de probabilidad para n = ${n}, L = ${L} y t = ${t} es aproximadamente: ${result}`;
    }

    // Animación
    function toggleAnimation() {
        animationRunning = !animationRunning;
        document.getElementById('toggleAnimationBtn').innerText = animationRunning ? 'Pausar Animación' : 'Reanudar Animación';
        if (animationRunning) {
            interval = setInterval(animateWave, 30);
        } else {
            clearInterval(interval);
        }
    }

    function animateWave() {
        if (!animationRunning) return;
        t += 0.05;
        const newData = generateData(t, n, L);
        chart.data.datasets[0].data = newData.waveFunction;
        chart.data.datasets[1].data = newData.probabilityDensity;
        chart.update();
        update3DPlot();
    }

    // Gráfica en 3D

    function update3DPlot() {
    const z = Array.from({ length: 50 }, (_, i) => x.map((xi) => probDensity(xi, i * 0.1, n, L)));
    const xMid = L / 2;
    const zMid = probDensity(xMid, t, n, L);

    Plotly.react('3dPlot', [{
        x: x,
        y: Array.from({ length: 50 }, (_, i) => i * 0.1),
        z: z,
        type: 'surface',
        colorscale: 'Viridis',
    },
], {
        title: 'Evolución Temporal de la Densidad de Probabilidad',
        scene: {
            xaxis: { title: 'Posición (x)' },
            yaxis: { title: 'Tiempo (t)' },
            zaxis: { title: 'Densidad de Probabilidad' },
            camera: {
                eye: { x: 1.5, y: 1.5, z: 1.5 },
            }
        }
        
    });
}
<!-- Exportar datos -->

    function exportData() {
        const format = document.getElementById('exportFormat').value;
        const data = x.map((xi, idx) => ({
            Posicion: xi,
            Onda: waveFunction[idx],
            DensidadProbabilidad: probabilityDensity[idx],
        }));

        if (format === 'csv') {
            const csv = 'Posición, Onda, Densidad de Probabilidad\n' +
                data.map((row) => `${row.Posicion},${row.Onda},${row.DensidadProbabilidad}`).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'datos.csv';
            link.click();
        } else if (format === 'xlsx') {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.json_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, 'Datos');
            XLSX.writeFile(wb, 'datos.xlsx');
        } else if (format === 'pdf') {
            // Crear una tabla HTML para la exportación en PDF usando la funcionalidad nativa del navegador
            let htmlContent = '<html><body><h1>Simulación de Función de Onda</h1><table border="1"><tr><th>Posición</th><th>Onda</th><th>Densidad de Probabilidad</th></tr>';
            data.forEach((row) => {
                htmlContent += `<tr><td>${row.Posicion}</td><td>${row.Onda}</td><td>${row.DensidadProbabilidad}</td></tr>`;
            });
            htmlContent += '</table></body></html>';

            // Crear un iframe invisible para que el navegador lo convierta en PDF
            const iframe = document.createElement('iframe');
            iframe.style.position = 'absolute';
            iframe.style.width = '0px';
            iframe.style.height = '0px';
            iframe.style.border = 'none';
            document.body.appendChild(iframe);

            // Escribir el contenido HTML en el iframe y usar el método print del navegador
            iframe.contentWindow.document.open();
            iframe.contentWindow.document.write(htmlContent);
            iframe.contentWindow.document.close();
            iframe.contentWindow.focus();
            iframe.contentWindow.print();

            // Eliminar el iframe después de la impresión
            document.body.removeChild(iframe);
        }
    }

        function openHelp() {
            document.getElementById('helpOverlay').style.display = 'block';
        }

        function closeHelp() {
            document.getElementById('helpOverlay').style.display = 'none';
        }

    function updateSteps(n, L) {
    const stepsList = document.getElementById('stepsList');
    stepsList.innerHTML = '';

    // Paso 1: Fórmula general de ψ(x, t, n)
    const step1 = `1. Calculamos ψ(x, t, n) = √(2/L) * sin(nπx/L) * cos(t).`;

    // Paso 2: Fórmula para la densidad de probabilidad
    const step2 = `2. La densidad de probabilidad es |ψ|² = ψ²(x, t).`;

    // Paso 3: Evaluar en x = L/2
    const xMid = L / 2;
    const step3 = `3. Evaluamos en x = L/2 = ${xMid}.`;

    // Paso 4: Sustitución y cálculo final
    const coef = Math.sqrt(2 / L); // Coeficiente √(2/L)
    const sinValue = Math.sin((n * Math.PI * xMid) / L); // Valor del seno
    const waveFunction = coef * sinValue; // ψ(x, t)
    const result = waveFunction ** 2; // Densidad de probabilidad |ψ|²
    const step4 = `4. Sustituyendo n=${n}, L=${L}, el resultado es:
        ψ(x, t) = √(2/${L}) * sin(${n}π(${xMid})/${L}) = ${coef.toFixed(4)} * ${sinValue.toFixed(4)} = ${waveFunction.toFixed(4)}.
        Densidad de probabilidad |ψ|² = ${result.toFixed(4)}`;

    // Añadir los pasos a la lista
    const steps = [step1, step2, step3, step4];
    steps.forEach(step => {
        const li = document.createElement('li');
        li.innerText = step;
        stepsList.appendChild(li);



    } );

}

    // Inicializar gráficos y animación automática
    updateSteps(n, L);
    updateGraph();



    function validateInputs() {
    const quantumNumber = document.getElementById('quantumNumber');
    const boxSize = document.getElementById('boxSize');
    const time = document.getElementById('time');

    if (parseFloat(quantumNumber.value) < 1) {
        alert('El número cuántico (n) debe ser al menos 1.');
        quantumNumber.value = 1;
    }
    if (parseFloat(boxSize.value) <= 0) {
        alert('El tamaño de la caja (L) debe ser mayor que 0.');
        boxSize.value = 0.1;
    }
    if (parseFloat(time.value) < 0) {
        alert('El tiempo (t) no puede ser negativo.');
        time.value = 0;
    }
}

document.querySelector('button[onclick="updateGraph()"]').addEventListener('click', () => {
    validateInputs();
    updateGraph();
});

</script>

</body>

</html>
